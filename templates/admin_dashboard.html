<script>
document.addEventListener("DOMContentLoaded", () => {

const bookingTable = document.getElementById("bookingTable");
const pageNumber = document.getElementById("pageNumber");
const searchInput = document.getElementById("searchInput");
const statusFilter = document.getElementById("statusFilter");
const serviceFilter = document.getElementById("serviceFilter");
const prevPage = document.getElementById("prevPage");
const nextPage = document.getElementById("nextPage");
const statusChart = document.getElementById("statusChart");
const serviceChart = document.getElementById("serviceChart");
const monthlyChart = document.getElementById("monthlyChart");

let bookings = [];
let filtered = [];
let currentPage = 1;
const perPage = 10;

async function loadData() {
    const res = await fetch("/api/bookings");
    const data = await res.json();

    bookings = data.bookings || [];
    filtered = bookings;

    loadServices();
    updateSummaryFromAPI(data);
    renderTable();
    updateCharts();
}

function updateSummaryFromAPI(summary) {
    document.getElementById("summaryCards").innerHTML = `
        <div class="col-md-3"><div class="card p-3">Total ${summary.total}</div></div>
        <div class="col-md-3"><div class="card p-3">Confirmed ${summary.confirmed}</div></div>
        <div class="col-md-3"><div class="card p-3">Pending ${summary.pending}</div></div>
        <div class="col-md-3"><div class="card p-3">Rejected ${summary.rejected}</div></div>
    `;
}

function loadServices() {
    const services = [...new Set(bookings.map(b => b.service || "Unknown"))];
    serviceFilter.innerHTML =
        '<option value="">All Services</option>' +
        services.map(s => `<option>${s}</option>`).join("");
}

function renderTable() {
    if (!filtered.length) {
        bookingTable.innerHTML =
          `<tr><td colspan="12" class="text-center">No data</td></tr>`;
        return;
    }

    bookingTable.innerHTML = filtered.map((b,i)=>`
        <tr>
            <td>${i+1}</td>
            <td>${b.name || "-"}</td>
            <td>${b.phone || "-"}</td>
            <td>${b.service || "-"}</td>
            <td>${b.status || "Pending"}</td>
        </tr>
    `).join("");
}

loadData();
});
</script>
